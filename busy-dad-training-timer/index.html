<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busy Dad Training Program Timer</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div x-data="timerApp()" class="max-w-md mx-auto p-4">
        <h1 class="text-3xl font-bold text-center mb-6 text-blue-600">Busy Dad Training Timer</h1>
        
        <div class="mb-4">
            <label for="reps" class="block text-lg font-medium mb-2">Number of Reps:</label>
            <input type="number" id="reps" x-model="reps" min="1" class="w-full p-2 text-xl border rounded" required>
        </div>
        
        <div class="mb-4">
            <label for="warmup" class="block text-lg font-medium mb-2">Warm-up Time (seconds):</label>
            <input type="number" id="warmup" x-model="warmupTime" min="0" max="60" class="w-full p-2 text-xl border rounded" required>
        </div>
        
        <div class="mb-6 text-center">
            <p class="text-lg font-medium">Base Session Time: 20 minutes</p>
            <p class="text-lg font-medium">Time per Rep: <span x-text="timePerRep.toFixed(2)"></span> seconds</p>
        </div>
        
        <div class="flex justify-center space-x-4 mb-6">
            <button @click="start" x-show="!isRunning" class="bg-green-500 text-white px-6 py-3 rounded-lg text-xl font-bold shadow-md">Start</button>
            <button @click="reset" class="bg-red-500 text-white px-6 py-3 rounded-lg text-xl font-bold shadow-md">Reset</button>
        </div>
        
        <div x-show="isRunning" class="grid grid-cols-3 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow-md text-center">
                <p class="text-sm text-gray-600" x-text="isWarmup ? 'Warm-up Time' : 'Total Time'"></p>
                <p class="text-2xl font-bold" x-text="isWarmup ? formatTime(warmupCountdown) : formatTime(remainingTime)"></p>
            </div>
            <div x-show="!isWarmup" class="bg-white p-4 rounded-lg shadow-md text-center">
                <p class="text-sm text-gray-600">Rep Time</p>
                <div class="flex justify-center items-baseline">
                    <span class="text-2xl font-bold" x-text="Math.floor(repCountdown / 1000)"></span>
                    <span class="text-xl font-bold">.</span>
                    <span class="text-xl font-bold w-16 inline-block text-left" x-text="Math.floor((repCountdown % 1000) / 100)"></span>
                </div>
            </div>
            <div x-show="!isWarmup" class="bg-white p-4 rounded-lg shadow-md text-center">
                <p class="text-sm text-gray-600">Reps Left</p>
                <p class="text-2xl font-bold" x-text="repsLeft"></p>
            </div>
        </div>
        
        <div x-show="isCompleted" class="text-center">
            <h2 class="text-3xl font-bold text-green-600 mb-4">Congratulations!</h2>
            <p class="text-xl">You've completed the Busy Dad Training Program!</p>
        </div>
    </div>

    <script>
        function timerApp() {
            return {
                reps: 100,
                warmupTime: 15,
                isRunning: false,
                isCompleted: false,
                isWarmup: false,
                remainingTime: 20 * 60 * 1000, // in milliseconds
                warmupCountdown: 0,
                repCountdown: 0,
                repsLeft: 0,
                interval: null,
                countdown3: new Audio('countdown_3.mp3'),
                countdown2: new Audio('countdown_2.mp3'),
                countdown1: new Audio('countdown_1.mp3'),
                newRepBeep: new Audio('new_rep_start.mp3'),
                warmupBeep: new Audio('warmup_start.mp3'),
                
                get timePerRep() {
                    return (20 * 60) / this.reps;
                },
                
                start() {
                    if (this.isRunning) return;
                    this.isRunning = true;
                    this.isCompleted = false;
                    this.repsLeft = this.reps;
                    this.warmupCountdown = this.warmupTime * 1000;
                    this.isWarmup = this.warmupTime > 0;
                    if (this.isWarmup) {
                        this.warmupBeep.play();
                    } else {
                        this.remainingTime = 20 * 60 * 1000;
                    }
                    this.repCountdown = this.timePerRep * 1000;
                    this.startTimer();
                },
                
                reset() {
                    clearInterval(this.interval);
                    this.isRunning = false;
                    this.isCompleted = false;
                    this.isWarmup = false;
                    this.remainingTime = 20 * 60 * 1000;
                    this.warmupCountdown = 0;
                    this.repCountdown = 0;
                    this.repsLeft = 0;
                },
                
                startTimer() {
                    const startTime = Date.now();
                    this.interval = setInterval(() => {
                        if (this.isWarmup) {
                            this.warmupCountdown = Math.max(this.warmupCountdown - 10, 0);
                            if (this.warmupCountdown <= 0) {
                                this.isWarmup = false;
                                this.remainingTime = 20 * 60 * 1000;
                                this.repCountdown = this.timePerRep * 1000;
                                this.newRepBeep.play();
                            }
                        } else {
                            const elapsedTime = Date.now() - startTime - (this.warmupTime * 1000);
                            this.remainingTime = Math.max(20 * 60 * 1000 - elapsedTime, 0);
                            
                            if (this.remainingTime <= 0) {
                                this.complete();
                                return;
                            }
                            
                            this.repCountdown = Math.max(this.repCountdown - 10, 0);
                            if (this.repCountdown <= 3000 && this.repCountdown > 2990) {
                                this.countdown3.play();
                            } else if (this.repCountdown <= 2000 && this.repCountdown > 1990) {
                                this.countdown2.play();
                            } else if (this.repCountdown <= 1000 && this.repCountdown > 990) {
                                this.countdown1.play();
                            }
                            if (this.repCountdown <= 0) {
                                this.newRepBeep.play();
                                this.repsLeft--;
                                this.repCountdown = this.timePerRep * 1000;
                            }
                        }
                    }, 10); // Update every 10ms for smoother countdown
                },
                
                complete() {
                    clearInterval(this.interval);
                    this.isRunning = false;
                    this.isCompleted = true;
                    this.celebrateCompletion();
                },
                
                celebrateCompletion() {
                    // Add celebration animation here (e.g., confetti)
                    console.log("Celebration!");
                },
                
                formatTime(milliseconds) {
                    const totalSeconds = Math.floor(milliseconds / 1000);
                    const minutes = Math.floor(totalSeconds / 60);
                    const seconds = totalSeconds % 60;
                    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            };
        }
    </script>
</body>
</html>